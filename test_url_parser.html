<!DOCTYPE html>
<html>
<head>
    <title>URL Parser Unit Tests</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a2e; color: #eee; }
        .test { margin: 10px 0; padding: 10px; border-radius: 6px; }
        .pass { background: #16a34a; }
        .fail { background: #dc2626; }
        h1 { color: #fff; }
        h2 { color: #94a3b8; margin-top: 30px; }
        pre { background: #0f0f23; padding: 10px; border-radius: 4px; overflow-x: auto; }
        .summary { margin-top: 30px; padding: 20px; background: #334155; border-radius: 8px; }
    </style>
</head>
<body>
    <h1>URL Parser Unit Tests</h1>
    <div id="results"></div>
    <div id="summary" class="summary"></div>

    <script>
        // Copy of parseUrlField function
        function parseUrlField(urlField) {
            if (!urlField) return [];

            let urlString = String(urlField).trim();

            // Handle JSON array format: ["url1", "url2"]
            if (urlString.startsWith('[')) {
                try {
                    const parsed = JSON.parse(urlString);
                    if (Array.isArray(parsed)) {
                        return parsed.map(u => String(u).trim()).filter(u => u.length > 5);
                    }
                } catch (e) {
                    // Not valid JSON, continue with string parsing
                }
            }

            // Split by common separators: comma, semicolon, newline, pipe
            const urls = urlString
                .split(/[,;\n|]+/)
                .map(u => u.trim())
                .filter(u => u.length > 5 && (u.startsWith('http://') || u.startsWith('https://')));

            return urls;
        }

        // Test cases
        const tests = [
            {
                name: "Single URL",
                input: "https://example.com/image.png",
                expected: ["https://example.com/image.png"]
            },
            {
                name: "Comma separated",
                input: "https://a.com/1.png, https://b.com/2.png",
                expected: ["https://a.com/1.png", "https://b.com/2.png"]
            },
            {
                name: "Semicolon separated",
                input: "https://a.com/1.png; https://b.com/2.png",
                expected: ["https://a.com/1.png", "https://b.com/2.png"]
            },
            {
                name: "Newline separated",
                input: "https://a.com/1.png\nhttps://b.com/2.png",
                expected: ["https://a.com/1.png", "https://b.com/2.png"]
            },
            {
                name: "Pipe separated",
                input: "https://a.com/1.png | https://b.com/2.png",
                expected: ["https://a.com/1.png", "https://b.com/2.png"]
            },
            {
                name: "JSON array",
                input: '["https://a.com/1.png", "https://b.com/2.png"]',
                expected: ["https://a.com/1.png", "https://b.com/2.png"]
            },
            {
                name: "Mixed separators",
                input: "https://a.com/1.png, https://b.com/2.png; https://c.com/3.png",
                expected: ["https://a.com/1.png", "https://b.com/2.png", "https://c.com/3.png"]
            },
            {
                name: "With extra spaces",
                input: "  https://a.com/1.png  ,   https://b.com/2.png  ",
                expected: ["https://a.com/1.png", "https://b.com/2.png"]
            },
            {
                name: "Empty string",
                input: "",
                expected: []
            },
            {
                name: "Null input",
                input: null,
                expected: []
            },
            {
                name: "Undefined input",
                input: undefined,
                expected: []
            },
            {
                name: "Real Softr URLs (your case)",
                input: "https://app-files-v1.softr-files.com/applications/4324d9cc-81a4-481a-a8d7-3f1037531243/uploads/010768ff-ab8d-4534-a4d7-c6c183ac46bf/1.png, https://app-files-v1.softr-files.com/applications/4324d9cc-81a4-481a-a8d7-3f1037531243/uploads/e4c30524-f9b0-45ca-97ac-71c2820ff837/2.png",
                expected: [
                    "https://app-files-v1.softr-files.com/applications/4324d9cc-81a4-481a-a8d7-3f1037531243/uploads/010768ff-ab8d-4534-a4d7-c6c183ac46bf/1.png",
                    "https://app-files-v1.softr-files.com/applications/4324d9cc-81a4-481a-a8d7-3f1037531243/uploads/e4c30524-f9b0-45ca-97ac-71c2820ff837/2.png"
                ]
            },
            {
                name: "URL with query params (edge case)",
                input: "https://example.com/image.png?v=1&size=large",
                expected: ["https://example.com/image.png?v=1&size=large"]
            },
            {
                name: "Invalid URL (no http)",
                input: "example.com/image.png",
                expected: []
            },
            {
                name: "Mixed valid and invalid",
                input: "https://valid.com/1.png, invalid.com/2.png, https://valid.com/3.png",
                expected: ["https://valid.com/1.png", "https://valid.com/3.png"]
            },
            {
                name: "HTTP (not just HTTPS)",
                input: "http://example.com/image.png",
                expected: ["http://example.com/image.png"]
            },
            {
                name: "Three URLs comma separated",
                input: "https://a.com/1.png, https://b.com/2.png, https://c.com/3.png",
                expected: ["https://a.com/1.png", "https://b.com/2.png", "https://c.com/3.png"]
            }
        ];

        // Run tests
        let passed = 0;
        let failed = 0;
        const resultsDiv = document.getElementById('results');

        tests.forEach((test, index) => {
            const result = parseUrlField(test.input);
            const isPass = JSON.stringify(result) === JSON.stringify(test.expected);

            if (isPass) {
                passed++;
            } else {
                failed++;
            }

            const testDiv = document.createElement('div');
            testDiv.className = `test ${isPass ? 'pass' : 'fail'}`;
            testDiv.innerHTML = `
                <strong>${isPass ? '✅' : '❌'} Test ${index + 1}: ${test.name}</strong>
                <pre>Input: ${JSON.stringify(test.input)}
Expected: ${JSON.stringify(test.expected)}
Got:      ${JSON.stringify(result)}</pre>
            `;
            resultsDiv.appendChild(testDiv);
        });

        // Summary
        document.getElementById('summary').innerHTML = `
            <h2>Summary</h2>
            <p><strong>Total:</strong> ${tests.length}</p>
            <p><strong style="color: #4ade80;">Passed:</strong> ${passed}</p>
            <p><strong style="color: #f87171;">Failed:</strong> ${failed}</p>
            <p><strong>Pass Rate:</strong> ${((passed / tests.length) * 100).toFixed(1)}%</p>
        `;
    </script>
</body>
</html>
